var n=Object.defineProperty;var a=(o,t,e)=>t in o?n(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var r=(o,t,e)=>a(o,typeof t!="symbol"?t+"":t,e);class u{constructor(){r(this,"statusElement");r(this,"outputSection");r(this,"errorSection");r(this,"outputElement");r(this,"errorElement");this.statusElement=document.getElementById("status"),this.outputSection=document.getElementById("output-section"),this.errorSection=document.getElementById("error-section"),this.outputElement=document.getElementById("output"),this.errorElement=document.getElementById("error-message"),this.init()}init(){var t,e,s,i;(t=document.getElementById("summarize-page"))==null||t.addEventListener("click",()=>{this.summarizePage()}),(e=document.getElementById("summarize-selection"))==null||e.addEventListener("click",()=>{this.summarizeSelection()}),(s=document.getElementById("copy-btn"))==null||s.addEventListener("click",()=>{this.copyToClipboard()}),(i=document.getElementById("options-btn"))==null||i.addEventListener("click",()=>{chrome.runtime.openOptionsPage()}),this.checkConfiguration()}async checkConfiguration(){const t=await chrome.storage.sync.get(["apiKey","provider"]);t.apiKey?this.updateStatus(`Ready to summarize (${t.provider||"openai"})`):(this.showError("Please configure your API key in the options page."),this.disableButtons())}disableButtons(){document.querySelectorAll(".action-btn").forEach(e=>{e.disabled=!0})}async summarizePage(){this.updateStatus("Extracting page content..."),this.hideOutput(),this.hideError();try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t.id)throw new Error("No active tab found");const e=await chrome.tabs.sendMessage(t.id,{type:"GET_PAGE_TEXT"});if(!e||!e.text)throw new Error("No readable content found on this page.");this.updateStatus("Generating summary...");const s=await chrome.runtime.sendMessage({type:"RUN_SUMMARY",mode:"page",text:e.text,title:t.title,url:t.url});this.handleResponse(s)}catch(t){this.showError(t instanceof Error?t.message:"Failed to summarize page")}}async summarizeSelection(){this.updateStatus("Getting selection..."),this.hideOutput(),this.hideError();try{const[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(!t.id)throw new Error("No active tab found");const e=await chrome.tabs.sendMessage(t.id,{type:"GET_SELECTION"});if(!e||!e.text)throw new Error("No text selected. Please select at least 50 characters.");this.updateStatus("Generating summary...");const s=await chrome.runtime.sendMessage({type:"RUN_SUMMARY",mode:"selection",text:e.text,title:t.title,url:t.url});this.handleResponse(s)}catch(t){this.showError(t instanceof Error?t.message:"Failed to summarize selection")}}handleResponse(t){t.ok&&t.summary?(this.showOutput(t.summary),this.updateStatus("Summary generated successfully")):this.showError(t.error||"Failed to generate summary")}updateStatus(t){this.statusElement.textContent=t}showOutput(t){this.outputElement.textContent=t,this.outputSection.classList.remove("hidden"),this.errorSection.classList.add("hidden")}showError(t){this.errorElement.textContent=t,this.errorSection.classList.remove("hidden"),this.outputSection.classList.add("hidden"),this.updateStatus("Error occurred")}hideOutput(){this.outputSection.classList.add("hidden")}hideError(){this.errorSection.classList.add("hidden")}async copyToClipboard(){const t=this.outputElement.textContent;if(t)try{await navigator.clipboard.writeText(t);const e=document.getElementById("copy-btn");e.textContent="âœ… Copied!",setTimeout(()=>{e.textContent="ðŸ“‹ Copy"},2e3)}catch(e){console.error("Failed to copy to clipboard:",e)}}}document.addEventListener("DOMContentLoaded",()=>{new u});
